<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>27</title>
  <link rel="stylesheet" href="../css/styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    .frame-container {
      width: 370px;
      height: 80vh;
      position: relative;
      margin: 0 auto;
      overflow: hidden;
    }

    .frame-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
      cursor: pointer;
      transition: opacity 0.3s ease;
    }

    #frame2 {
      opacity: 0;
      pointer-events: none;
    }

    .rocket-container {
      position: absolute;
      bottom: 25%;
      left: 0;
      z-index: 10;
      width: 100%;
      text-align: left;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .rocket-container img {
      max-width: 100%;
      max-height: 100px;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      position: absolute;
      left: 0px;
    }

    .bullet {
      position: absolute;
      width: 20px;
      height: auto;
      transition: top 0.1s linear;
      z-index: 5;
    }

    .meteor, .heart {
      position: absolute;
      width: 40px;
      height: auto;
      z-index: 2;
      pointer-events: none;
    }

    .explosion {
      position: absolute;
      width: 60px;
      height: 60px;
      z-index: 15;
      pointer-events: none;
      animation: explode 0.5s ease-out forwards;
    }

    @keyframes explode {
      0% {
        transform: scale(0.3);
        opacity: 1;
      }
      50% {
        transform: scale(1.2);
        opacity: 0.8;
      }
      100% {
        transform: scale(1.5);
        opacity: 0;
      }
    }
  </style>
</head>
<body class="js">
  <nav>
    <a href="index.html">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
        <path fill="#ffffff" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/>
      </svg>
    </a>
  </nav>

  <main>
    <header>
      <h1>27-challenge-events-time</h1>
    </header>

    <section>
      <div class="app">
        <div class="frame-container">
          <img src="images/Frame-22.svg" alt="Frame 1" class="frame-image" id="frame1" onclick="switchFrames()" />
          <img src="images/Frame-2.svg" alt="Frame 2" class="frame-image" id="frame2" />

          <!-- Cohete -->
          <div class="rocket-container" id="rocketContainer">
            <img src="images/Rectangle1.svg" alt="Cohete" />
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    let meteorInterval;
    let heartInterval;
    let bullets = [];
    let meteors = [];

    function switchFrames() {
      const frame1 = document.getElementById('frame1');
      const frame2 = document.getElementById('frame2');
      const rocketContainer = document.getElementById('rocketContainer');

      frame1.style.opacity = '0';
      frame1.style.pointerEvents = 'none';

      frame2.style.opacity = '1';
      frame2.style.pointerEvents = 'auto';

      rocketContainer.style.opacity = '1';
      rocketContainer.style.pointerEvents = 'auto';

      startMeteorRain();
      startHeartRain();
      startCollisionDetection();
    }

    const cohete = document.querySelector('#rocketContainer img');
    const frameContainer = document.querySelector('.frame-container');
    let position = 0;
    cohete.style.left = '0px';

    document.addEventListener('keydown', (event) => {
      const containerWidth = frameContainer.clientWidth;
      const coheteWidth = cohete.clientWidth;
      const maxRight = containerWidth - coheteWidth;

      if (event.code === 'ArrowRight') {
        if (position < maxRight) {
          position += 40;
          if (position > maxRight) position = maxRight;
          cohete.style.transform = `rotateY(180deg)`;
          cohete.style.left = `${position}px`;
        }
      }

      if (event.code === 'ArrowLeft') {
        if (position > 0) {
          position -= 40;
          if (position < 0) position = 0;
          cohete.style.transform = `rotateY(0deg)`;
          cohete.style.left = `${position}px`;
        }
      }

      if (event.code === 'Space') {
        shootBullet();
      }
    });

    function shootBullet() {
      const bullet = document.createElement('img');
      bullet.src = 'images/disparo1.svg';
      bullet.classList.add('bullet');

      const rocketRect = cohete.getBoundingClientRect();
      const frameRect = frameContainer.getBoundingClientRect();

      const offsetLeft = rocketRect.left - frameRect.left + cohete.clientWidth / 2 - 10;
      const offsetTop = rocketRect.top - frameRect.top;

      bullet.style.left = `${offsetLeft}px`;
      bullet.style.top = `${offsetTop}px`;

      frameContainer.appendChild(bullet);

      const bulletData = {
        element: bullet,
        x: offsetLeft,
        y: offsetTop,
        active: true
      };

      bullets.push(bulletData);

      let currentTop = offsetTop;

      const interval = setInterval(() => {
        currentTop -= 10;
        bullet.style.top = `${currentTop}px`;
        bulletData.y = currentTop;

        if (currentTop < -20) {
          bullet.remove();
          bulletData.active = false;
          bullets = bullets.filter(b => b.active);
          clearInterval(interval);
        }
      }, 30);
    }

    // Diferentes tipos de meteoritos con sus explosiones específicas
    const meteorTypes = [
      { 
        images: ['images/meteoritovertical1.png'], 
        color: 'blue', 
        explosion: 'images/explocionmeteoritoazul.png'
      },
      { 
        images: ['images/meteoritovertical2.png'], // Cambiado: imagen del meteorito rojo real
        color: 'red', 
        explosion: 'images/explocionmeteoritorojo.png'  // Esta es la explosión roja
      },
      { 
        images: ['images/meteoritoverical3.png'], 
        color: 'green', 
        explosion: 'images/explocionmeteoritoverde.png'
      }
    ];

    const heartImages = [
      'images/corazoncallendo1.png',
      'images/corazoncallendo2.png'
    ];

    function createVerticalObject(type, images, className, meteorType = null) {
      const obj = document.createElement('img');
      obj.src = images[Math.floor(Math.random() * images.length)];
      obj.classList.add(className);

      const containerWidth = frameContainer.clientWidth;
      const startLeft = Math.random() * (containerWidth - 40);

      obj.style.left = `${startLeft}px`;
      obj.style.top = `-60px`;

      frameContainer.appendChild(obj);

      const objData = {
        element: obj,
        x: startLeft,
        y: -60,
        active: true,
        type: meteorType
      };

      if (className === 'meteor') {
        meteors.push(objData);
      }

      let y = -60;

      const fall = setInterval(() => {
        y += 4;
        obj.style.top = `${y}px`;
        objData.y = y;

        if (y > frameContainer.clientHeight) {
          obj.remove();
          objData.active = false;
          if (className === 'meteor') {
            meteors = meteors.filter(m => m.active);
          }
          clearInterval(fall);
        }
      }, 30);
    }

    function createExplosion(x, y, explosionImage) {
      const explosion = document.createElement('img');
      explosion.src = explosionImage;
      explosion.classList.add('explosion');
      explosion.style.left = `${x - 30}px`;
      explosion.style.top = `${y - 30}px`;

      frameContainer.appendChild(explosion);

      setTimeout(() => {
        explosion.remove();
      }, 500);
    }

    function checkCollisions() {
      bullets.forEach((bullet, bulletIndex) => {
        if (!bullet.active) return;

        meteors.forEach((meteor, meteorIndex) => {
          if (!meteor.active) return;

          const bulletRect = {
            x: bullet.x,
            y: bullet.y,
            width: 20,
            height: 20
          };

          const meteorRect = {
            x: meteor.x,
            y: meteor.y,
            width: 40,
            height: 40
          };

          if (bulletRect.x < meteorRect.x + meteorRect.width &&
              bulletRect.x + bulletRect.width > meteorRect.x &&
              bulletRect.y < meteorRect.y + meteorRect.height &&
              bulletRect.y + bulletRect.height > meteorRect.y) {
            
            // Colisión detectada
            createExplosion(meteor.x + 20, meteor.y + 20, meteor.type.explosion);
            
            // Remover bala y meteorito
            bullet.element.remove();
            meteor.element.remove();
            bullet.active = false;
            meteor.active = false;
          }
        });
      });

      // Limpiar arrays
      bullets = bullets.filter(b => b.active);
      meteors = meteors.filter(m => m.active);
    }

    function startCollisionDetection() {
      setInterval(checkCollisions, 16); // ~60 FPS
    }

    function startMeteorRain() {
      if (!meteorInterval) {
        meteorInterval = setInterval(() => {
          const randomType = meteorTypes[Math.floor(Math.random() * meteorTypes.length)];
          createVerticalObject('meteor', randomType.images, 'meteor', randomType);
        }, 1500);
      }
    }

    function startHeartRain() {
      if (!heartInterval) {
        heartInterval = setInterval(() => {
          createVerticalObject('heart', heartImages, 'heart');
        }, 5000);
      }
    }
  </script>
</body>
</html>